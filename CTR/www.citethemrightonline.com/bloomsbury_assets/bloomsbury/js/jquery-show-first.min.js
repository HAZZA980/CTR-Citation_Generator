
jQuery(function($){$.fn.showFirst=function(options){var $group=$(this);var showFirst=new ShowFirst($group,options);showFirst.init();return showFirst;};var viewMoreTxt=$('#view-more').val();var defaults={controlTemplate:'<div class="view_more"><a href="#" class="show-first-control">'+viewMoreTxt+'</a></div><div class="clearfix"></div>',count:10,hasControl:true};function ShowFirst($group,options)
{this.$group=$group;this.settings=$.extend({},defaults,options);this.$items=this.$group.children();this.hasSurplus=this.$items.length>this.settings.count;if(this.hasSurplus){this.indexStartOfRest=this.settings.count;this.$itemsFirst=this.$items.slice(0,this.indexStartOfRest);this.$itemsRest=this.$items.slice(this.indexStartOfRest);}}
ShowFirst.prototype.init=function(){if(this.hasSurplus){this.$itemsRest.hide();if(this.settings.hasControl){this.addControl();}}};ShowFirst.prototype.addControl=function(){var tokens=[{pattern:new RegExp("\\[TOTAL_COUNT\\]","g"),value:this.$items.length},{pattern:new RegExp("\\[FIRST_COUNT\\]","g"),value:this.$itemsFirst.length},{pattern:new RegExp("\\[REST_COUNT\\]","g"),value:this.$itemsRest.length}];this.controlWithValues=this.settings.controlTemplate;for(var i=0;i<tokens.length;i++){this.controlWithValues=this.controlWithValues.replace(tokens[i].pattern,tokens[i].value);}
this.$controlHtml=$(this.controlWithValues);this.$itemsRest.last().after(this.$controlHtml);$(".show-first-control",this.$controlHtml).click($.proxy(function(event){event.preventDefault();this.$controlHtml.toggle();this.$itemsRest.toggle();$('.view_more').show();var viewMoreTxt=$('#view-more').val();var viewLessTxt=$('#view-less').val();if($.trim(this.$controlHtml[0].innerText)===viewMoreTxt){this.$controlHtml[0].lastChild.innerText=viewLessTxt;}else{this.$controlHtml[0].lastChild.innerText=viewMoreTxt;}},this));};$(".show-first").each(function(){var $group=$(this);var options={};options.controlTemplate=$group.data("show-first-control-template");options.count=$group.data("show-first-count");options.hasControl=$group.data("show-first-has-control");$group.showFirst(options);});});
